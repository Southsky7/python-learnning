# 	HTTP协议

- URL：Uniform Resource Locator,统一资源定位，即网络地址，类似www.baidu.com

### 使用HTTP协议访问Web

- 输入URL时，Web浏览器从Web服务器端获取文件资源(resource)等信息从而显示出web页面。
- 像这种通过发送请求获取服务器资源的Web浏览器等都可称为客户端(Client)
- Web使用HTTP(HyperText Transfer Protocol,超文本传输协议)作为规范完成从客户端到服务器端一系列运作流程，可以说Web是建立在HTTP协议上通信的

### HTTP的诞生

- CERN(欧洲核子研究组织)的蒂姆伯纳斯李博士提出了一种能让远隔两地的研究者们共享知识的设想，最初设想的基本理念是:借助多文档之间相互关联形成的超文本连成可互相参阅的WWW(World Wide Web,万维网)
- 到今天已提出了3项WWW构建技术，分别是
  - 把SGML(Standard Generalized Markup Language,标准通用标记语言)作为页面的文本标记语言的HTML
  - 作为文档传递协议的HTTP
  - 指定文档所在地址的URL
- 1997年1月公布的HTTP/1.1是目前主流的HTTP协议版本，可见作为Web文档传输协议的HTTP版本几乎没有更新，HTTP/2.0正在制定，但达到较高覆盖率仍需较长时间。
- 当年HTTP出现是为了解决文本传输的难题，由于协议本身十分简单，于是在此基础上设想了很多应用方法并投入了实际使用，现在HTTP协议已经超出了Web这个框架的局限，被运用到了各种场景里。

### 网络基础TCP/IP

- 通常使用的网络是在TCP/IP协议族的基础上运作的，而HTTP属于它内部的一个自己。
- 不同的硬件、操作系统之间的通信都需要一种规则，这种规则称为协议。把与互联网相关联的协议集合起来总称为TCP/IP。

### TCP/IP的分层管理

- TCP/IP协议按层次分为4层:应用层、传输层、网络层和数据链路层。

### 1.应用层

- 应用层决定了向用户提供应用服务时通信的活动。
- TCP/IP协议族内预存了各类通用的应用服务，如FTP(File Transfer Protocol,文件传输协议)、DNS(Domain Name System,域名系统)等。
- HTTP协议也属于应用层。

#### 2.传输层

- 传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。
- 在传输层有两个性质不同的协议：TCP(Transmission Control Protocol,传输控制协议)和UDP(User Data Protocol,用户数据报协议)

#### 3.网络层，又名网络互连层

- 网络层用于处理在网络上流动的数据包，数据包是网络传输的最小数据单位。该层规定了通过怎样的路径(即传输路线)到达对方计算机并把数据包传给对方。
- 与对方计算机之间通过多台计算机或网络设备进行传输时，网络层所起的作用就是在众多的选项内选择一条传输路线。
- IP协议属于该层

#### 4.链路层，又名数据链路层，网络接口层

- 用来处理网络连接的硬件部分，包括控制操作系统、硬件的设备驱动、NIC(NetWork Interface Card,网络适配器，即网卡)及光纤等物理可见部分，硬件上的范畴均在链路层的作用范围之内。

### TCP/IP通信传输流

- ![image-20211020150312043](http://r19kczb6x.hn-bkt.clouddn.com/img/image-20211020150312043.png)

- 利用TCP/IP协议族进行网络通信时，会通过分层顺序与对方进行通信，发送端从应用层往下走，接收端则从链路层往上走。
- 以HTTP举例，作为发送端的客户端在应用层(HTTP协议)发出一个想看某个Web页面的HTTP请求，为了传输方便，在传输层(TCP协议)把应用层处收到的数据(HTTP请求报文)进行分割，并在各个报文上打上标记序号及端口号后发送给网络层。在网络层(IP协议)增加作为通信目的地的MAC地址后转发给链路层，这样发送网络的通信请求就准备齐全了。
- 接收端的服务器在链路层收到数据，按序向上发送，当传输到应用层，才能算真正接收到由客户端发送过来的HTTP请求。
- 发送端在层层传输时每经过一层必定会被打上一个该层所属的首部信息，反之，接收端会逐层消去信息。
- 这种把数据信息包装起来的做法叫做封装。

### 与HTTP关系密切的协议:IP、TCP和DNS

#### 1.负责传输的IP协议

- 按层次分，IP(Internet Protocol)网际协议位于网络层，IP与IP地址不同，IP是一种协议的名称。
- IP协议的作用是把各种数据包传送给对方，而要确保确实传送到对方需要满足各类条件，其中两个最重要的条件是IP地址和MAC地址(Media Access Control Address，媒体存取控制地址)。
- MAC地址，直译为媒体存取控制地址，也称为局域网地址(LAN Address),MAC位址，以太网地址(Ethernet Address)或物理地址(Physical Address),它是一个用来确认网络设备位置的位址。在OSI模型中，第三层网络负责IP地址，第二层数据链路层负责MAC位址.MAC地址用于在网络中唯一标示一个网卡，一台设备，每个网卡需要并会有唯一的MAC地址。
- IP地址指明了节点被分配到的地址，MAC地址是网卡所属的固定地址，IP地址可与MAC地址进行配对，IP地址可变换，MAC地址基本不变。

##### 使用ARP协议凭借MAC地址进行通信

- IP间的通信依赖MAC地址，网络上通信双方在同一局域网(LAN)情况很少，通常是经过多台计算机和网络设备中转才能连接到对方，在中转是会利用下一站中专设备的MAC地址来搜索下一个中转目标，这时会采用ARP协议(Address Resolution Protocol，地址解析协议)，根据通信方的IP地址就可以反查出对应的MAC地址。
- 在到达通信目标前的中转过程中，那些计算机和路由器等网络设备只能获悉很粗略的传输路线，这种机制称为路由选择。

#### 2.确保可靠性的TCP协议

- TCP位于传输层，提供可靠的字节流服务，字节流服务(Byte Stream Service)是指为了方便运输将大块数据分割成以报文段(segment)为单位的数据包进行管理，可靠的传输服务指能把数据准确可靠的传给对方，即TCP协议是为了更容易传送大数据才把数据分割，且TCP协议能够确认数据最终是否送达到对方。

- ##### 确保数据能到达目标

  - 为了准确无误的将数据送达目标处，TCP协议采用了三次握手(three-way handshaking)策略，用TCP协议把数据包送出去后，TCP会向对方确认是否成功送达，握手过程中使用了TCP的标志(flag)-SYN(synchronize)和ACK(acknowledgement)。
  - 发送端先发送一个带SYN标志的数据包给对方，接收端收到后会回传一个带有SYN/ACK标志的数据包以示传达确认信息，最后发送端再回传一个带ACK标志的数据包代表握手结束。
  - 若在握手过程中某个阶段莫名中断，TCP协议会在此以相同顺序发送数据包。

#### 3.负责域名解析的DNS服务

- DNS(Domain Name System,域名系统)服务是和HTTP协议一样位于应用层的协议，它提供域名到IP地址之间的解析服务。
- 计算机既可以被赋予IP地址，也可以被赋予主机名和域名。
- 用户通常使用主机名或域名访问对方计算机，因为IP地址纯数字不好记忆，但计算机更擅长处理数字，因此DNS诞生，DNS协议通过域名查找IP地址或逆向服务。

### 统一资源标识符URI  Uniform Resource Identifier

- Uniform:规定统一的格式可方便处理多种不同类型的资源而不同根据上下文环境来识别资源指定的访问方式且加入新增的协议方案(如http、ftp)也更容易。

- Resource:资源的定义是可标识的任何东西，如文档文件，图像，服务

- Identifier:可标识的对象，即标识符。

- 综上，URI是由某个协议方案表示的资源的定位标识符，协议方案指访问资源所使用的协议类型名称

- 采用HTTP协议时，协议方案就是HTTP，标准URI协议方案有30种，如ftp、telnet、net、mailto

- URI用字符串标识某一资源而URL表示资源的地点，so URL是URI的子集/

- 常见URI:

  - http://www.baidu.com
  - ftp://ftp.is.co.za/rfc/rfc1808.txt
  - telnet://192.0.2.16:80/

  ![image-20211020165826356](http://r19kczb6x.hn-bkt.clouddn.com/img/image-20211020165826356.png)

- 登录信息(认证)：指定用户名和密码作为从服务器端获取资源时必要的登录信息(身份认证),可选项
- 服务器地址:使用绝对URI必须指定待访问的服务器地址。
- 服务器端口号:指定服务器连接的网络端口号，用户省略则自动使用默认端口号
- 带层次的文件路径:指定服务器上的文件路径来定位特指的资源
- 查询字符串:针对已指定的文件路径内的资源，可以使用查询字符串传入任意参数，可选项。
- 片段标识符:使用片段标识符通常可标记处已获取资源种的子资源，可选项

## HTTP基础

- HTTP协议用于客户端与服务器之间的通信
- HTTP协议规定请求从客户端发出，最后服务器响应该请求且返回。 
- ![image-20211020175445263](http://r19kczb6x.hn-bkt.clouddn.com/img/image-20211020175445263.png)

#### 发送请求:

- GET表示请求访问服务器的类型，称为方法，字符串指明了请求访问的资源对象，也叫请求URI(request-URI),最后的HTTP/1.1,用来提示客户端使用的HTTP协议功能。
- 请求报文是由请求方法、请求URI、协议版本、可选的请求首部字段和内容实体构成。

#### 响应请求：

- 开头的HTTP/1.1表示版本，200 OK表示请求的处理结果的状态码(status code)和原因短语(reason-phrase).下一行是创建响应的日期时间，以一个空行分隔，之后内容称为资源实体的主体。
- 响应报文由协议版本、状态码(表示成功或失败的数字代码)、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。



- HTTP是一种不保存状态，即无状态stateless协议，其自身不对请求和响应之间的通信状态进行保存。
- 为了保存用户状态，引入了Cookie技术用于管理状态。
- HTTP协议使用URI定位互联网上的资源，客户端发送请求时，URI需要将作为请求报文种的请求URI包含在内。
- 对服务器本身发起请求时可用*代替请求URI

### 告知服务器意图的HTTP方法

#### 1.GET:获取资源

- 用于请求访问已被URI识别的资源，指定的资源经服务器端解析后返回响应内容。 

#### 2.POST:传输实体主体

- GET方法也可以传输主体，但一般用POST方法，POST方法主要是传输，不是获取响应。

#### 3.PUT:传输文件

- 妖气再请求报文主题包含文件内容然后保存在请求URI指定位置。但由于PUT方法不带验证机制，有安全问题，一般Web网站不用此方法。

#### 4.HEAD:获得报文首部

- 与GET方法一样，但不返回主体部分，用于确认URI的有效性及资源更新的日期时间。

#### 5.DELETE:删除文件

- 与PUT相反，用于删除请求URI指定的资源，但也不带验证机制，所以一般不用。

#### 6.OPTIONS:询问支持的方法

- 用于查询对请求URI指定的资源支持的方法。

#### 7.TRACE:追踪路径

- 让Web服务器将之前的请求通信返回给客户端的方法
- 易引发XST(Cross-Site Tracing，跨站追踪)攻击，不怎么用。

#### 8.CONNECT：要求用隧道协议连接代理

- 此方法要求与代理服务器通信时建立隧道用于TCP通信，主要使用SSL(Secure Sockets Layer,安全套接层)和TLS(Transport Layer Security,传输层安全)协议把通信内容加密后经网络隧道传输。
- 格式：CONNECT 代理服务器名:端口号 HTTP版本

### 持久连接

- HTTP初始版本每进行一次HTTP通信就要断开一次TCP连接。
- 持久连接特点是只要一段未提出断开连接就保持TCP连接状态。减少了TCP重复建立和断开的额外开销，减轻了服务器端的负载，使HTTP请求和响应更早结束，Web显示时间提高。
- 持久连接使管线化称为可能，最初发送请求后得到响应才能发送下一个请求，管线化之后可用并行发送多个请求。

### Cookie

- Cookie技术通过在请求和响应报文种写入Cookie信息来控制客户端状态。
- Cookie根据响应报文中的Set-Cookie首部字段信息，通知客户端保存Cookie，当下次客户端在往服务器发送请求时，客户端会自动在请求报文中添加Cookie值，服务器通过对比Cookie值就知道从哪个客户端发来信息，从而得到之前的状态信息。

## HTTP报文

![image-20211020224848478](http://r19kczb6x.hn-bkt.clouddn.com/img/image-20211020224848478.png)

![image-20211020224900773](http://r19kczb6x.hn-bkt.clouddn.com/img/image-20211020224900773.png)

- 用于HTTP协议交互的信息被称为HTTP报文，分为请求报文和响应报文。其本身是有多行数据构成的字符串文本。

- 不一定要有报文主体。

- #### 首部内容组成

  - 请求行：包含用于请求的方法，请求URI和HTTP版本
  - 状态行：包含表明响应结果的状态码，原因短语和HTTP版本
  - 首部字段：包含请求和响应的各种条件和属性的各类首部。首部有4种:通用首部、请求首部、响应首部和实体首部
  - 其他，如HTTP的RFC里未定义的首部(Cookie等)

#### 编码提升传输速率

- HTTP在传输数据时可以按数据样貌直接传输也可以在传输过程中通过编码提升传输速率，但编码由计算机完成因此会消耗更多CPU资源。
- 报文message：HTTP通信的基本单位，由8位组字节流(octet sequence,octet为8个比特)组成，通过HTTP通信传输
- 实体entity:作为请求或响应的有效载荷数据被传输，其内容由实体首部和实体主体组成。
- HTTP报文的主体用于传输请求或响应的实体主体，通常二者相等，仅当传输时进行编码操作时，实体主体内容变化，才与报文主体产生差异。

#### 压缩传输的内容编码

- 内容编码指应用在实体内容上的编码格式，并保持实体信息原样压缩，编码后的实体由客户端接收并负责解码。
- 常见内容编码：
  - gzip(GNU zip)
  - compress(UNIX系统的标准压缩)
  - deflate(zlib)
  - identify(不进行编码)

#### 分块传输编码

- 传输大容量数据时通过把数据分割成多块，能够让浏览器逐步显示页面，这种把实体主体分块的功能称为分块传输编码Chunked Transfer Coding
- 分块传输编码把实体主体分成多个部分，每块都用十六进制标记块的大小，实体主体的最后一块用0(CR+LF)来标记。实体主体由客户端负责解码，恢复到编码前的实体主体。

### MIME

- 发送邮件时可以添加多份附件是因为采用了MIME机制，Multipurpose Internet Mail Extensions,多用途因特网邮件扩展，它允许邮件处理文本、图片、视频等多个不同类型的数据，MIME扩展中使用了称为多部份对象集合(Multipart)的方法来容纳多份不同类型的数据。
- HTTP协议也采纳了多部分对象集合，发送的一份报文主体内可含有多类型实体，通常是在图片或文本文件等上传时使用。
- 多部份对象集合包含的对象：
  - multipart/form-data:在Web表单文件上传时使用
  - multipart/byteranges:状态码206(Partial Conent,部分内容)响应报文包含多个范围的内容时使用。
  - HTTP报文中使用多部份对象集合时，需要在首部字段里加上Content-type。
  - 使用boundary字符串来划分多部份对象集合指明的各类实体。在boundary字符串指定的各个实体起始行之前插入--(如--AaB03x)标记，在最后插入--如(--AaB03x--)作为结束
  - 多部份集合对象每个部分类型都可以含有首部字段且可以在某个部分嵌套使用多部分对象集合。

### 获取部分内容的范围请求

- 以前下载过程中若中断就需要重新下载，为了解决此问题，需要一种可恢复的机制，即从中断处恢复下载。
- 要实现该功能需要指定下载的实体范围，指定范围发送的请求叫做范围请求。
- 对一份10000字节大小的资源，使用范围请求只能请求5001~1000字节内的资源。
- 执行范围请求时，使用首部字段Range来指定资源的byte范围。

- 5001~10000字节：Range:bytes = 5001 - 10000       5001字节之后全部的:Range:bytes:5001 - 
- 多重范围，如开始到3000字节和5000~7000字节：Range:bytes = 0 - 3000,5000-7000
- 针对范围请求，响应返回状态码为206 Partial Conent的响应报文且对于多重范围的范围请求，响应会在首部字段Conent-Type标明multipart/byteranges后返回响应报文。若服务器无法响应范围请求，则会返回状态码200 OK和完整实体内容。

### 内容协商

- 同一个Web网站可能存在多份内容相同的页面，如中文和英文页面，内容相同却语言不同，当浏览器默认语言为中文则浏览器对应显示中文，这种机制叫内容协商
- 内容协商机制是指客户端和服务器端就响应的资源内容进行交涉然后提供客户端最适合的资源，内容协商以语言、字符串、编码方式等基准判断资源。
- 常见的首部字段中的判断基准:
  - Accept
  - Accept-Charset
  - Accept-Encoding
  - Accept-Language
  - Content-Language
- 内容协商有3种类型：
  - 服务器驱动协商 Server -driven Negotiation,以服务器端进行内容协商，以请求的首部字段为参考，在服务器端自动处理，但对用户来算根据浏览器发送的信息不一定能筛选出最优内容。
  - 客户端驱动协商 Agent-driven Negotiation，由客户端进行内容协商的方式，用户从浏览器显示的可选项列表手动选择，也可以用JavaScript脚本在Web页面自动进行上述选择，如按OS的类型或浏览器类型自行切换成PC页面或手机页面
  - 透明协商Transport Negotiation，两者相结合。

# 状态码

- 状态码职责是当客户端向服务器发送请求时，描述返回的请求结果，借助它用户可以知道服务器是正常处理了请求还是出现了错误。

- 状态码由3位数字和原因短语组成，如200 OK,数字第一位指定了响应类别，后两位无分类。

  |      | 类别                           | 原因短语                   |
  | ---- | ------------------------------ | -------------------------- |
  | 1XX  | Informtional,信息性状态码      | 接收的请求正在处理         |
  | 2XX  | Success,成功状态码             | 请求正常处理完毕           |
  | 3XX  | Redirection,重定向状态码       | 需要进行附加操作以完成请求 |
  | 4XX  | Client Error,客户端错误状态码  | 服务器无法处理请求         |
  | 5XX  | Server Error，服务器错误状态码 | 服务器处理请求出错         |


### 常用的14种状态码

- 200 OK，表示客户端发来的请求在服务器被正常处理。响应报文中，随状态码返回的信息会因方法不同而改变。如使用GET方法时，对应请求资源的实体会作为响应返回，使用HEAD方法时，响应中只返回首部不返回实体的主体部分。
- 204 No Content,代表服务器接收的请求成功处理，但响应报文不含实体的主体部分，一般在只需客服端往服务器发送信息而服务器不需要对客户端发送更新信息时使用。
- 206 Partal Content，表示客服端进行了范围请求，而服务器成功执行了这部分的GET请求，响应报文包含由Content-Range指定范围的实体范围。
- 301 Moved Permanently,永久重定向。表示请求的资源被分配了新的URI，应该使用新的URI。
- 302 Found，临时性重定向，表示请求的资源分配了新的URI，希望用户本次使用新的URI。
- 303 See Other,表示请求资源有另一个URI，应使用GET方法定向获取请求的资源，与302有相同的功能，但303明确表示客户端应该采用GET方法。
- 301 302 303状态码返回时，几乎所有浏览器都会把POST改为GET，并删除请求报文主体，然后再次发送请求。
- 304 Not Modified,表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但未满足条件时，直接返回304 Not Modified，304返回时不包含任何响应的主体部分，304虽然划分在3xx类别但和重定向无任何关联。
- 307 Temporary Redirct,临时重定向，与302相同，但尽管302标准禁止POST改为GET，但实际使用时大家不遵守，而307会遵守标准不把POST改为GET。
- 403 Forbidden，表示请求被服务器拒绝，服务器没要必要给出拒绝的详细理由，但如果想做说明的话可以在实体的主体部分给出原因。未获得文件系统的访问授权，访问权限出现某些问题等情况都是403的原因。
- 404 Not Found，表明服务器上找不到请求的资源，在服务器拒绝且不想说明理由时也会404
- 500 Internal Server Error，表明服务器端在执行请求时发送了错误，也可能是Web应用存在的bug和某些临时的故障。
- 503 Service Unavailable,表示服务器暂时处于超负载或正在停机维护，如果事先得知解除此状况需要的时间，最好写入Retry-Afer首部字段在返回给客户端。
- 不少返回的状态码响应都是错误的，比如Web应用程序内部发生错误，状态码仍然返回200 OK

### 单台虚拟主机实现多个域名

- HTTP/1.1允许一台HTTP服务器搭建多个Web站点，如Web托管服务(Web Hosting Service)供应商可用一台服务器为多位客户服务，也可以以每位客户持有的域名运行各自不同的网站，这是因为用了虚拟主机的功能，即使物理层面仅有一台服务器但使用了虚拟主机的功能就可以假想有多台服务器。
- 互联网上域名通过DNS服务映射到IP地址(域名解析)之后访问目标网站，即请求发送到服务器时已经是IP地址的形式，因此若一台服务器托管了www.jd.jp和www.baidu.jp两个域名，收到请求时就需要弄清到底是访问哪个域名。
- 相同IP地址下，虚拟主机可寄存多个不同主机名和域名的Web网站，因此发送HTTP请求时必须在Host首部内完整指定主机名或域名的URI

### 通信数据转发程序：代理、网关、程序

- HTTP通信时除了客户端和服务器还有些用于通行数据转发的应用程序，如代理、网关、隧道，用于配合服务器工作。
- 这些应用程序和服务器能将请求发给下一站服务器然后接收从那台服务器的响应在转发给客户端。

#### 代理：

- 有转发功能的应用程序，扮演客户端和服务器的中间人角色，接收客户端请求转发给服务器，同时也接收服务器返回的响应转发给客户端
- 代理不改变请求URI，直接发送给前方持有资源的目标服务器，持有资源实体的服务器叫源服务器，从源服务器返回的响应经过代理服务器在传给客户端。每次通过代理服务器时都会追加写入Via首部信息以标记经过的主机信息(如Via:proxy1)
- 使用代理服务器理由有:利用缓存技术减少网络带宽流量，组织内部针对特定网站的访问控制，以获取访问日志为主要目的等。
- 代理有多种使用方法，以两种基准分类，一是是否使用缓存，二是是否修改报文。
- 缓存代理：代理转发响应时，缓存代理预先将资源副本保存在代理服务器上，当代理再次收到相同资源的请求时直接将缓存资源返回而不经过源服务器。
- 透明代理:转发请求和响应时不对报文做任何加工的代理类型称为透明代理，反之，对报文内容加工的代理称为非透明代理。

#### 网关：

- 转发其他服务器通信数据的服务器，接收从客户端发过来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理，一些客户端甚至不知道其通信目标是网关。
- 网关工作机制和代理相似，但网关能将HTTP请求转化为其他协议通信。
- 利用网关能提高通信安全性，因为可以在客户端和网关之间的通信线路上加密以确保连接安全，比如网关可以连接数据库使用SQL查询数据，也可以在Web购物网站上使用信用卡结算时用网关和信用卡结算系统联动。

#### 隧道：

- 在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。
- 隧道可按要求建立一条与其他服务器的通信线路，届时使用SSL等加密手段通信，隧道目的是确保客户端和服务器进行安全的通信。
- 隧道本身不会解析HTTP请求，即请求保持原样中转给服务器，隧道会在通信双方断开连接时结束。
- 隧道本身是透明的，客户端不用在意隧道的存在。

## 缓存：

- 指代理服务器或客户端本地磁盘保存的资源副本，利用缓存可减少对源服务器的访问也就节省了通信流量和通信时间
- 缓存服务器是代理服务器的一种并归类在缓存代理类型中，当代理转发从服务器返回的响应时代理服务器会保存资源副本。

#### 缓存有效期限：

- 当源服务器资源更新，若使用不变的缓存，就会演变成返回旧资源，因此即使存在缓存也会因为客户端的要求、缓存有效期等因素想源服务器确认资源的有效性，若判断缓存失效，缓存服务器就会再次从源服务器上获取新资源。

#### 客户端的缓存：

- 缓存不仅可存在于缓存服务器中也可存于客户端浏览器中，如IE把客户端缓存称为临时网络文件Temporary Internet File。
- 浏览器缓存若有效，就不必在向服务器请求相同资源，可直接从本地磁盘读取。浏览器缓存也存在有效期。

## HTTP首部

- 报文分为报文首部 空格CR+LF 报文主体，首部内容为客户端和服务器分别处理请求和响应提供所需要的信息，对于客户端来算这些信息中的大部分内容无序亲自查看。

#### 请求报文

- 报文首部由:请求行(包括方法、URI、HTTP版本等)，请求首部字段、通用首部字段、实体首部字段、其他组成

#### 响应报文

- 报文首部由状态行(HTTP版本，状态码)，响应首部字段，通用首部字段，实体首部字段，其他组成



- 报文众多字段中，首部字段包含信息最丰富。
- 使用首部字段是为了给浏览器和服务器提供报文主体大小、所使用的语言、认证信息等。

#### 首部字段结构：

- 首部字段名:字段值       
- HTTP首部以Content-Type这个字段表示报文主体的对象类型，如Content-Type:text/html
- 一个首部字段可以由多个字段值，如Keep-Alive:timeout = 15,max = 100
- 当出现首部字段重复的情况，根据浏览器不同结果可能不一致，一些会优先处理第一次出现的首部字段，一些会优先处理最后出现的首部字段。

#### 4种HTTP首部字段类型

- 通用首部字段 General Header Fields,请求报文和响应报文两方都会使用的首部。
- 请求首部字段 Request Header Fields,从客户端向服务器端发送请求报文使用的首部，补充了请求的附加内容、客户端信息、响应内容相关优先级等信息。
- 响应首部字段Response Header Fields,从服务器端向客户端返回相应报文时使用的首部，补充了响应的附加内容，也会要求客户端附加额外的内容信息
- 实体首部字段Entity Header Fields，针对请求报文和响应报文的实体部分使用的字段，补充了资源内容更新时间等与实体有关的信息。

#### 端到端首部和逐跳首部

- HTTP首部字段将定义成缓存代理和非缓存代理的行为，分为2种类型
- 端到端首部 End-to-end Header:分在此类别中的首部会转发给请求/响应对应的最终接收目标且必须保存在由缓存生成的响应中，且它必须被转发。
- 逐跳首部 Hop-by-hop Header,分在此类别的首部只对单次转发有效，会因通过缓存或代理而不再转发。HTTP/1.1和之后版本若要使用hop-by-hop首部需提供Connection首部字段。
- HTTP/1.1中的逐跳首部字段(除此8个其余都属于端到端首部):
  - Connection
  - Keep-Alive
  - Proxy-Authenticate
  - Proxy-Authorization
  - Trailer
  - TE
  - Transfer-Encoding
  - Upgrade

## HTTP/1.1通用首部字段

#### 1.Cache-Control

- 用于操作缓存
- 指令的参数是可选的，多个指令用逗号分隔，首部字段的Cache-Control指令用于请求及响应时
- eg:Cache-Control:private,max-age=0,no-cache

#### 1.1 表示能否缓存的指令

- public指令，表明其他用户也可利用缓存。
- private指令，响应只以特定用户为对象，缓存服务器对特定用户提供资源缓存服务，其他用户则不返回缓存
- no-cache指令，用于防止从缓存中返回过期的资源。
  - 当客户端请求包含此指令，表示客户端不会接收缓存过的响应，此时中间的缓存服务器必须把客户端请求转发给源服务器。  
  - 当服务器返回的指令包含此指令则缓存服务器不能缓存此资源。
  - 当对no-cache指定参数值，如no-cache=Location(只能在响应指令中指定参数),那么客户端接收到这个指定参数值的首部字段后就不能使用缓存，即无参数首部字段可以缓存

#### 1.2 控制可执行缓存的对象的指令

- no-store指令，暗示请求和对应的响应包含机密信息，使缓存不能在本地存储请求或响应的任一部分。

#### 1.3 指定缓存期限和认证的指令

- s-maxage指令，eg: Cache-Control:s-maxage=6040(单位为s)。功能与max-age相同，它们的不同点是s-maxage指令只适用于供多位用户使用的公共缓存服务器(即代理)，对于向同一用户重复返回响应的服务器来说无效。且使用此指令后会直接忽略对Expires首部字段和max-age的处理。
- max-age指令:用于判定缓存资源的缓存时间，若小于指定时间则客户端就接收缓存资源，当max-age=0，缓存服务器通常需要将请求转发给源服务器。
  - 当服务器返回的响应包括max-age指令，缓存服务器不再对资源有效性进行确认，而max-age数字代表资源保存为缓存的最长时间。
  - HTTP/1.1版本的缓存服务器同时遇到max-age和Expires首部字段，优先处理max-age而忽略掉Expires，HTTP/1.0则恰好相反。
- min-fresh指令，要求缓存服务器返回至少还未过指定时间的缓存资源，eg:Cache-Control:min-fresh=60,表示60秒内若有超过有效期限的资源都无法作为响应返回了。
- max-stale指令，如果指令未指定参数值，那么无论经过多久客户端都会接收响应，若指定了数值,eg:Cache-Control:max-stale=3600,那么即使过期，只要处于指定时间内，客户端仍然接收。
- only-if-cached指令，表示客户端仅在缓存服务器本地缓存目标资源情况下才要求其返回，即该指令要求缓存服务器不重新加载响应，也不确定资源有效性。若无效应返回状态码504 Gateway Timeout
- must-revalidate指令，代理会向服务器再次验证即将返回的响应缓存是否有效，若代理无法连通源服务器再次获取有效资源，缓存必须给客户端一条504 Gateway Timeout状态码。使用此指令时会忽略max-stale指令
- proxy-revalidate指令，要求所有缓存服务器接收到客户端带有该指令的请求返回响应之前必须再次验证缓存有效性。
- no-transform指令，规定无论在请求或响应，缓存都不能改变实体主体的媒体类型，可用于防止缓存或代理压缩图片等。

### 2.Connection

- 控制不再转发给代理的首部字段 eg:Connection:Upgrade,则Upgrade经过代理服务器时被删除
- 管理持久连接，HTTP/1.1版本默认连接是持久连接，当想断开连接时，Connection:close，HTTP/1.1之前版本默认非持久连接，若想持久连接则Connection:Keep-Alive

### 3.Date

- 表明创建HTTP报文的日期时间。
- eg: Date:Tue,03 Jul 2012 04:40:59 GMT

### 4.Pragma

- HTTP/1.1之前版本的历史遗留字段，仅作为与HTTP/1.0的向后兼容而定义，形式唯一：Pragma:no-cache,该首部字段属于通用首部字段，但只用在客户端发送的请求中，客户端会要求所有中间件服务器不返回缓存的资源。
- 若所有服务器都以HTTP/1.1为基准，直接采用Cache-Control:no-cache，但这不现实，因此发送的请求会同时有两个首部字段:Cache-Control:no-cache    Pragma:no-cache

### 5.Trailer

