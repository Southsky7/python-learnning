# 10.推导和生成

### 1.列表推导

- 列表推导可以达到与map，filter相同的效果

- ```python
  print(list(map(ord,'twz')))       #[116, 119, 122]
  print([ord(x) for x in 'twz'])    #[116, 119, 122]
  
  print(list(filter(lambda x: x % 2 == 0,range(10))))      #[0, 2, 4, 6, 8]
  print([x for x in range(10) if x % 2 == 0])              #[0, 2, 4, 6, 8]
  ```

- 格式：  [expreesion for target1 in iterable1 if condition1

  ​                                    for target2 in iterable2 if condition2...]  可以编写任意数量的嵌套的for循环

- map调用比等效的for循环快两倍，而列表推导往往比map更快。

### 2.生成器函数和表达式

- 它提供了在需要时才产生结果的工具而不是立即产生结果
- 生成器函数:使用常规def语句进行编写，但是使用yield语句一次返回一个结果，在每次结果产生之间挂起和恢复它们的状态。
- 生成器表达式:类似列表推导，但是它们返回按需产生结果的对象，而不是创建一个结果列表。
- 二者都不会一次性的创建一个列表，节省了内存空间，允许计算时间分摊到各次结果请求上。

#### 2.1 生成器函数:yield vs return

- 也用def语句编写，但是它们被特殊的编译成一个支持迭代协议的对象，且调用时不会返回一个结果，而是返回一个可以出现在任何迭代上下文的结果生成器。
- 与返回一个值且退出的常规函数不同，生成器函数能自动挂起且在生成值的时刻恢复之前的状态并继续函数的执行，因此它们能很方便的替代提前计算整个一系列值或是在类中手动保存和在类中恢复状态的方式。
- 生成器函数与常规函数区别:生成器函数生成(yield)一个值，而不是返回(return)一个值。

```python
def gensquares(N):
    for i in range(N):
        yield i **2
for i in gensquares(5):
    print(i)               #0 1 4 9 16
x = gensquares(4)
print(x)             #<generator object gensquares at 0x000001DDA622C9E0>
print(next(x))       #0
print(next(x))       #1
print(next(x))       #4
print(next(x))       #9
```

- 生成器函数优点:
  - 生成器对于大型程序而言，在内存使用和性能方面更好，它允许函数避免预先做好所有工作，在结果的列表很大或处理每个结果需要很多时间时尤其明显，生成器将产生一系列值的时间分散到每一次的循环迭代中取。
  - 有了生成器，函数作用域中的变量能自动的保存和恢复
  - 可以处理或返回任何类型的对象，且能像可迭代对象那样出现在迭代上下文中。

#### 2.2 生成器表达式 

- 优点:

  - 生成器表达式是一种对内存空间的优化，它不需要像方括号的列表推导一样一次构造出整个结果列表，与生成器函数一样它将生成结果的过程拆分成更小的时间片:它会一部分一部分的产生结果，而不是让调用者在一次调用中等待整个集合被创建出来。
  - 它实际运行起来慢于列表推导，因此只对结果集合非常大的运算或不能等待全部数据产生的应用来说是最佳选择。

- 生成器表达式类似列表推导，但是它包括在圆括号中(类似元组，括号是可选的)

- ```python
  a = (x **2 for x in range(5))    #生成器表达式，和元组一样，它的括号是可选的
  b = [x **2 for x in range(5)]    #列表推导
  print(a)                         #<generator object <genexpr> at 0x00000118ACFA9660>
  print(b)                         #[0, 1, 4, 9, 16]，不需要用list来显示
  ```

- 从执行过程上来说，生成器表达式与map，filter等不同，它不是在内存中构建结果，而是返回一个生成器对象(一个自动被创建的可迭代对象)，可以用next()来输出