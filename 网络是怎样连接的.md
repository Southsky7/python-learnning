# 网络是怎样连接的

### 旅程总览

1. 当我们输入URL时，浏览器按照一定规则分析URL含义并根据含义生成请求消息再发给Web服务器，浏览器并不亲自负责数据传送，它将委托操作系统中的网络控制软件将消息发送给服务器，第一章的内容就是浏览器将数据委托出去之前的过程。

2. 协议栈(即刚才提到的网络控制软件)将从浏览器收到的消息打包再加上目的地址等地址信息(协议栈还有其他功能，如发生通信错误时重新发送包，调节数据发送的速率，可将其当作帮助寄信的秘书)，然后协议栈将包交给网卡(负责以太网或无线网络通信的硬件)，网卡将包转换成电信号且通过网线发送出去，这样包就进入网络中了。

3. 客户端计算机可通过家庭、公司进入互联网或单独接入互联网。假设客户端计算机连接到家庭或公司局域网中，再通过ADSL和光纤到户(FTTH)等宽带线路接入互联网。此时网卡发送的包会经过交换机等设备到达用来接入互联网的路由器，路由器后面就是互联网。

4. 接着数据从接入网路的路由器出发进入了互联网内部。互联网入口线路称为接入网，通常可用电话线、ISDN、ADSL、有线电视、光线、专线等多种通信线路接入互联网，这些通称为接入网。接入网连接到签约的网络运营商，并接入被称为接入点(Point of Presence,PoP)的设备。

   1. 接入点的实体是专为运营商设计的路由器，可列解为离家最近的邮局。
   2. 接入点后面就是互联网的骨干部分了。骨干网中存在很多运营商和大量路由器，它们相互连接形成巨大的网，网络包就在其中经过若干路由器的接力最终被发送到目标Web服务器上。
   3. 无论在互联网中还是家庭公司的局域网中，包都是以相同方式运输的，这是互联网的一大特征。
   4. 运营商使用的路由器与家用路由器不同，它是一种可连接几十根网线的高速大型路由器，互联网骨干部分存在大量这种路由器，它们以复杂的形式连接起来，网络包就在这种路由器中穿行。
   5. 家庭和公司局域网一般用以太网线连接，而互联网中除了以太网连接，还有电话技术和光通信技术来传送网络包。

5. 通过骨干网后网络包最终到达了Web服务器所在局域网，接着会遇到防火墙，检查完后可能会遇到缓存服务器，若访问的网页数据在服务器中能找到，那么就不必劳烦Web服务器，直接从缓存服务器读取数据。大型网站可能还会匹配将消息分布到多台Web服务器上的负载均衡器，还可能使用通过分布在整个互联网中的缓存服务器来分发内容的服务，经过这些机制，网络包才到达Web服务器。

6. 网络包到达Web服务器后，数据被解包且还原为原始的请求消息，然后交给Web服务器程序，这个操作也由协议栈完成。然后Web服务器分析请求消息的含义，按照其指示将数据装入响应消息并发给客户端。响应消息回到客户端的过程与之前介绍的过程恰好相反。当响应道道客户端后，浏览器会从中读取出网页的数据并显示在屏幕上。

7. ### bingo!

# 1.浏览器生成消息

- 输入URL后，浏览器对其解析然后根据其含义生成请求消息，通过请求消息将用户需要的数据告知服务器。浏览器如何解析？请求消息实际长什么样？
- 请求消息生成后，浏览器委托操作系统向Web服务器发送请求，但浏览器必须告诉操作系统接收方的IP地址，因此浏览器必须先查出Web服务器的IP地址，网址中只有Web服务器域名，浏览器需向DNS服务器查询域名对应的IP地址。浏览器如何进行这一操作？
- 全球有上万台DNS服务器，它们相互接力才能完成IP地址查询。它们如何接力?
- 查到IP地址后，浏览器便可委托操作系统发送給Web服务器。如何委托？

### 1.1 生成HTTP请求消息

- URL除了http:，还有ftp:,file:,mailto:开头的，之所以有各种各样的URL是因为浏览器除了访问Web浏览器，还可以用来在FTP服务器(File Transfer Protocol,文件传输协议，使用FTP协议来传送文件的程序也叫做FTP)上下载和上传文件，也具备电子邮件客户端的功能。

